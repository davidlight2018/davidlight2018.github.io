<!DOCTYPE html>
<html>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
    
    
        
            
                <link rel="shortcut icon" href="/images/favicon.ico">
            
        
        
            
                <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
            
        
        
            
                <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
            
        
    
    <!-- title -->
    <title>『CS228笔记』Inference ── Variable Elimination</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+SC&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/gh/tonsky/FiraCode@2/distr/fira_code.css" rel="stylesheet">
    <!-- rss -->
    
    
<meta name="generator" content="Hexo 4.2.0"></head>

<body class="max-width mx-auto px3 ltr">

    <div id="header-post">
    <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
    <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
    <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i
                class="fas fa-chevron-up fa-lg"></i></a>
    <span id="menu">
    <span id="nav">
      <ul>
          
              <li><a href="/">Home</a></li>
          
              <li><a href="/archives/">Articles</a></li>
          
              <li><a href="/category/">Category</a></li>
          
              <li><a href="/tags/">Tag</a></li>
          
              <li><a href="/about/">About</a></li>
          
              <li><a href="/search/">Search</a></li>
          
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
          
              <li><a class="icon" href="/2020/05/11/cs228_representation_bayesian_networks/"><i class="fas fa-chevron-left"
                                                                           aria-hidden="true"
                                                                           onmouseover="$('#i-prev').toggle();"
                                                                           onmouseout="$('#i-prev').toggle();"></i></a></li>
          
          
              <li><a class="icon" href="/2020/04/26/www18_donut/"><i class="fas fa-chevron-right"
                                                                           aria-hidden="true"
                                                                           onmouseover="$('#i-next').toggle();"
                                                                           onmouseout="$('#i-next').toggle();"></i></a></li>
          
          <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i
                          class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();"
                          onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true"
                                        onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();"
                                        onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
    <li><a class="icon"
           href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://blog.tsinghua2018.top/2020/05/11/cs228_inference_variable_elimination/&title=『CS228笔记』Inference ── Variable Elimination"><i
                    class="fab fa-qq " aria-hidden="true"></i></a></li>
    <li><a class="icon"
           href="https://service.weibo.com/share/share.php?url=http://blog.tsinghua2018.top/2020/05/11/cs228_inference_variable_elimination/&title=『CS228笔记』Inference ── Variable Elimination"><i
                    class="fab fa-weibo " aria-hidden="true"></i></a></li>
    <li><a class="icon" href="https://twitter.com/share?url=http://blog.tsinghua2018.top/2020/05/11/cs228_inference_variable_elimination/&text=『CS228笔记』Inference ── Variable Elimination" target="_blank" rel="noopener"><i
                    class="fab fa-twitter " aria-hidden="true"></i></a></li>
    <li><a class="icon" href="mailto:?subject=『CS228笔记』Inference ── Variable Elimination&body=Check out this article: http://blog.tsinghua2018.top/2020/05/11/cs228_inference_variable_elimination/"><i
                    class="fas fa-envelope " aria-hidden="true"></i></a></li>
</ul>
    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一个例子"><span class="toc-number">1.</span> <span class="toc-text">一个例子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#eliminating-variables"><span class="toc-number">2.</span> <span class="toc-text">Eliminating Variables</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#factors"><span class="toc-number">2.1.</span> <span class="toc-text">Factors</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#factor-operations"><span class="toc-number">2.2.</span> <span class="toc-text">Factor Operations</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

<div class="content index py4">
    
    <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
        
    <h1 class="posttitle" itemprop="name headline">
        『CS228笔记』Inference ── Variable Elimination
    </h1>

        <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">
            David
            
        </span>
      </span>
            
    <div class="postdate">
        
            <time datetime="2020-05-11T11:44:41.000Z"
                  itemprop="datePublished">2020-05-11</time>
            
                (Updated:
                <time datetime="2020-05-12T11:59:07.454Z"
                      itemprop="dateModified">2020-05-12</time>)
            
        
    </div>

            
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/CS228-%E7%AC%94%E8%AE%B0/">CS228 笔记</a>
    </div>

            
        </div>
    </header>
    
    <div class="content" itemprop="articleBody">
        <blockquote>
<p>以下内容翻译自 <a href="https://ermongroup.github.io/cs228-notes/" target="_blank" rel="noopener">CS228 课程</a>。</p>
</blockquote>
<p>接下来，我们将注意力转向图形模型中的推理问题。给定概率模型（例如贝叶斯网络或马尔可夫随机场, MRF），我们有兴趣使用它来回答有用的问题，例如确定一封电子邮件是垃圾邮件的可能性。更正式地说，我们关注两种类型的问题：</p>
<ul>
<li><p>Marginal inference（边际推论）：将所有其他因素相加后，模型中给定变量的概率是多少？（例如垃圾邮件与非垃圾邮件的概率） <span class="math display">\[
p(y=1)=\sum_{x_{1}} \sum_{x_{2}} \cdots \sum_{x_{n}} p\left(y=1, x_{1}, x_{2}, \ldots, x_{n}\right)
\]</span></p></li>
<li><p>Maximum a posteriori (MAP) inference（最大后验推论）：对模型中变量的最可能赋值是什么？（可能取决于实际结果） <span class="math display">\[
\max _{x_{1}, \ldots, x_{n}} p\left(y=1, x_{1}, \ldots, x_{n}\right)
\]</span></p></li>
</ul>
<p>事实证明，推理是一项艰巨的任务。对于许多感兴趣的概率，要精确地回答这些问题中的任何一个都是 NP 问题。至关重要的是，推理是否容易处理取决于描述该概率的图的结构。如果问题难以解决，我们仍然可以通过近似推理方法获得有用的答案。</p>
<p>本章介绍第一个精确的推理算法，即变量消除。我们将在后面的章节中讨论近似推断。在本章的其余部分，我们将假设 <span class="math inline">\(x_i\)</span> 是离散变量，每个变量具有 <span class="math inline">\(k\)</span> 个可能的值。</p>
<blockquote>
<p>变量消除背后的原理也扩展到许多连续分布，例如高斯分布，但是我们在这里暂时不讨论这些扩展。</p>
</blockquote>
<h2 id="一个例子">一个例子</h2>
<p>首先考虑边际推理的问题。为简单起见，假设我们有一个链式贝叶斯网络，即形式为： <span class="math display">\[
p\left(x_{1}, \ldots, x_{n}\right)=p\left(x_{1}\right) \prod_{i=2}^{n} p\left(x_{i} | x_{i-1}\right)
\]</span> 我们对计算边际概率 <span class="math inline">\(p(x_n)\)</span> 感兴趣。最直观的计算方法是将所有 <span class="math inline">\(k^{n-1}\)</span> 个分配给 <span class="math inline">\(x_1, \dots, x_{n-1}\)</span> 的概率进行求和。 <span class="math display">\[
p\left(x_{n}\right)=\sum_{x_{1}} \cdots \sum_{x_{n-1}} p\left(x_{1}, \ldots, x_{n}\right)
\]</span> 但是，通过利用概率分布的因式分解，我们可以做的更好。我们可以将「某些变量」推入公式深处的方式来重写总和。 <span class="math display">\[
\begin{aligned}
p\left(x_{n}\right) &amp;=\sum_{x_{1}} \cdots \sum_{x_{n-1}} p\left(x_{1}\right) \prod_{i=2}^{n} p\left(x_{i} | x_{i-1}\right) \\
&amp;=\sum_{x_{n-1}} p\left(x_{n} | x_{n-1}\right) \sum_{x_{n-2}} p\left(x_{n-1} | x_{n-2}\right) \cdots \sum_{x_{1}} p\left(x_{2} | x_{1}\right) p\left(x_{1}\right)
\end{aligned}
\]</span> 我们首先对内部项进行求和，从 <span class="math inline">\(x_1\)</span> 开始，以 <span class="math inline">\(x_{n-1}\)</span> 结尾。具体而言，我们通过求和 <span class="math inline">\(x_1\)</span> 来计算中间因子 <span class="math inline">\(\tau\left(x_{2}\right)=\sum_{x_{1}} p\left(x_{2} | x_{1}\right) p\left(x_{1}\right)\)</span>。这需要 <span class="math inline">\(O(k^2)\)</span> 的时间，因为每次对于 <span class="math inline">\(x_2\)</span> 的赋值，都必须求和 <span class="math inline">\(x_1\)</span>。可以将得到的因子 <span class="math inline">\(\tau\left(x_{2}\right)\)</span> 视为具有 <span class="math inline">\(k\)</span> 个值的一张表（尽管不一定是概率），每个对 <span class="math inline">\(x_2\)</span> 的赋值都有一个条目（就像因子 <span class="math inline">\(p(x_1)\)</span> 可以视为表格一样）。然后，我们可以使用 <span class="math inline">\(\tau\)</span> 重写边际概率： <span class="math display">\[
p\left(x_{n}\right)=\sum_{x_{n-1}} p\left(x_{n} | x_{n-1}\right) \sum_{x_{n-2}} p\left(x_{n-1} | x_{n-2}\right) \cdots \sum_{x_{2}} p\left(x_{3} | x_{2}\right) \tau\left(x_{2}\right)
\]</span> 这与初始表达式具有相同的形式，只是我们少对一个变量进行求和。我们可以接着计算另一个因子 <span class="math inline">\(\tau\left(x_{3}\right)=\sum_{x_{2}} p\left(x_{3} | x_{2}\right) p\left(x_{2}\right)\)</span>，之后重复该过程直到只剩下 <span class="math inline">\(x_n\)</span>。既然每一步都花费 <span class="math inline">\(O(k^2)\)</span> 的时间，一共执行了 <span class="math inline">\(O(n)\)</span> 步，即推断一共花费 <span class="math inline">\(O(nk^2)\)</span> 的时间，比朴素方法 <span class="math inline">\(O(k^n)\)</span> 要好的多了。</p>
<p>我们在每一步中都消去（eliminating）了一个变量，也就是对应的算法名称。</p>
<h2 id="eliminating-variables">Eliminating Variables</h2>
<p>在使用特殊案例建立一些直观感受后，我们现在以一般形式介绍变量消除算法。</p>
<h3 id="factors">Factors</h3>
<p>假设我们给定一个图模型，由因子的乘积表示： <span class="math display">\[
p\left(x_{1}, \ldots, x_{n}\right)=\prod_{c \in C} \phi_{c}\left(x_{c}\right)
\]</span> 回想一下，我们可以将因子视为一张多维表，该多维表为变量 <span class="math inline">\(x_c\)</span> 的分布。在贝叶斯网络中，这些因素对应于条件概率分布；在马尔可夫随机场中，这些因子编码一个未归一化的分布。为了计算边际，我们首先计算函数的部分（也使用变量消除），然后使用未归一化的分布计算边际，最后将结果除以分区常数，以构造有效的边际概率。</p>
<h3 id="factor-operations">Factor Operations</h3>
<p>变量消除算法重复执行两个因子运算：乘积和边缘化。在链式的示例中，我们一直在隐事执行这些操作。</p>
<p>因子乘法操作简单地定义 <span class="math inline">\(\phi_1, \phi_2\)</span> 的乘法操作 <span class="math inline">\(\phi_{3}:=\phi_{1} \times \phi_{2}\)</span> 为： <span class="math display">\[
\phi_{3}\left(x_{c}\right)=\phi_{1}\left(x_{c}^{(1)}\right) \times \phi_{2}\left(x_{c}^{(2)}\right)
\]</span> 其中 <span class="math inline">\(\phi_3\)</span> 的范围定义为 <span class="math inline">\(\phi_1, \phi_2\)</span> 范围内变量的并集。<span class="math inline">\(x_{c}^{(i)}\)</span> 表示在 <span class="math inline">\(\phi_i\)</span> 范围内变量的赋值，其中 <span class="math inline">\(\phi_i\)</span> 被 <span class="math inline">\(x_c\)</span> 所限制。例如，我们定义 <span class="math inline">\(\phi_3(a,b,c) := \phi_1(a,b) \times \phi_2(b,c)\)</span>。</p>

    </div>
</article>

    
        <div id="footer-post-container">
    <div id="footer-post">

        <div id="nav-footer" style="display: none">
            <ul>
                
                    <li><a href="/">Home</a></li>
                
                    <li><a href="/archives/">Articles</a></li>
                
                    <li><a href="/category/">Category</a></li>
                
                    <li><a href="/tags/">Tag</a></li>
                
                    <li><a href="/about/">About</a></li>
                
                    <li><a href="/search/">Search</a></li>
                
            </ul>
        </div>

        <div id="toc-footer" style="display: none">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一个例子"><span class="toc-number">1.</span> <span class="toc-text">一个例子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#eliminating-variables"><span class="toc-number">2.</span> <span class="toc-text">Eliminating Variables</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#factors"><span class="toc-number">2.1.</span> <span class="toc-text">Factors</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#factor-operations"><span class="toc-number">2.2.</span> <span class="toc-text">Factor Operations</span></a></li></ol></li></ol>
        </div>

        <div id="share-footer" style="display: none">
            <ul>
    <li><a class="icon"
           href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://blog.tsinghua2018.top/2020/05/11/cs228_inference_variable_elimination/&title=『CS228笔记』Inference ── Variable Elimination"><i
                    class="fab fa-qq fa-lg" aria-hidden="true"></i></a></li>
    <li><a class="icon"
           href="https://service.weibo.com/share/share.php?url=http://blog.tsinghua2018.top/2020/05/11/cs228_inference_variable_elimination/&title=『CS228笔记』Inference ── Variable Elimination"><i
                    class="fab fa-weibo fa-lg" aria-hidden="true"></i></a></li>
    <li><a class="icon" href="https://twitter.com/share?url=http://blog.tsinghua2018.top/2020/05/11/cs228_inference_variable_elimination/&text=『CS228笔记』Inference ── Variable Elimination" target="_blank" rel="noopener"><i
                    class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
    <li><a class="icon" href="mailto:?subject=『CS228笔记』Inference ── Variable Elimination&body=Check out this article: http://blog.tsinghua2018.top/2020/05/11/cs228_inference_variable_elimination/"><i
                    class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
</ul>
        </div>

        <div id="actions-footer">
            <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i
                        class="fas fa-bars fa-lg"
                        aria-hidden="true"></i> Menu</a>
            <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i
                        class="fas fa-list fa-lg"
                        aria-hidden="true"></i> TOC</a>
            <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i
                        class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
            <a id="top" style="display:none" class="icon" href="#"
               onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg"
                                                                               aria-hidden="true"></i> Top
            </a>
        </div>

    </div>
</div>
    
    <footer id="footer">
    <div class="footer-left">
        Copyright &copy; 2020 <i class="fas fa-heart"></i>
        David
        
    </div>
    <!-- <div class="footer-right">
    <nav>
      <ul>
        
        <li><a href="/">Home</a></li>
        
        <li><a href="/archives/">Articles</a></li>
        
        <li><a href="/category/">Category</a></li>
        
        <li><a href="/tags/">Tag</a></li>
        
        <li><a href="/about/">About</a></li>
        
        <li><a href="/search/">Search</a></li>
        
      </ul>
    </nav>
  </div> -->

    <div class="footer-custom">
        Framework by <a href="https://hexo.io" target="_blank">Hexo</a> & Theme by <a
                href="https://github.com/xuthus5/hexo-theme-cactus" target="_blank">Cactus-CN</a>
        
    </div>
</footer>
</div>
<!-- styles -->

<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/5.12.1/css/all.min.css">


<link rel="stylesheet" href="https://cdn.staticfile.org/justifiedGallery/3.7.0/css/justifiedGallery.min.css">

<!-- jquery -->

<script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script>


<script src="https://cdn.staticfile.org/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

    
<script src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script>

    <script type="text/javascript">
        $(function () {
            // copy-btn HTML
            var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
            btn += '<i class="far fa-clone"></i>';
            btn += '</span>';
            // mount it!
            $(".highlight .code pre").before(btn);
            var clip = new ClipboardJS('.btn-copy', {
                target: function (trigger) {
                    return trigger.nextElementSibling;
                }
            });
            clip.on('success', function (e) {
                e.trigger.setAttribute('aria-label', "Copied!");
                e.clearSelection();
            })
        })
    </script>


<script src="/js/main.js"></script>

<!-- search -->


    

        

        
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css" crossorigin="anonymous">
            <script defer src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js" crossorigin="anonymous"></script>
            <script
                    defer
                    src="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/auto-render.min.js"
                    crossorigin="anonymous"
                    onload="renderMathInElement(document.body)">
            </script>
        

    

</body>

</html>